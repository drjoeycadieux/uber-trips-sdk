<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css">
  <title>Uber Trip Estimates Map</title>
</head>
<body>
  <div class="header-main-nav">
    <ul>
      <li>
        <p>Driver on Maps</p>
      </li>
      <li>
        <a href="/">Home</a>
      </li>
      <!-- <li>
        <a href="/map.html">Map</a>
      </li> -->
      <li>
        <a href="/request_trips.html">Request Trips</a>
      </li>
      <li>
        <a href="/estimates_trips.html">Estimates Trips</a>
      </li>
    </ul>
   </div>
   <div class="header">
        <p><strong>Welcome to</strong>  Driver on Maps</p>
        <!-- Add a form for user input -->
<form id="uberForm">
  <label for="startLat">Start Latitude:</label>
  <input type="text" id="startLat" name="startLat" required>
  <label for="startLng">Start Longitude:</label>
  <input type="text" id="startLng" name="startLng" required>
  <label for="endLat">End Latitude:</label>
  <input type="text" id="endLat" name="endLat" required>
  <label for="endLng">End Longitude:</label>
  <input type="text" id="endLng" name="endLng" required>
  <button type="submit">Get Trip Estimates</button>
</form>
   </div>
<div id="map"></div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1Ijoiam9leWNyZWF0b3IiLCJhIjoiY2xwbGR4bmNqMDNmcDJqcGV1OXY4Z2hteiJ9.yMegQFr9KWFFEsgmdbFRyg';
  const map = new mapboxgl.Map({
    container: 'map',
    style: "mapbox://styles/mapbox/dark-v10",
    center: [-73.5673, 45.5017], // Montreal coordinates (adjust as needed)
    zoom: 12,
  });

    // Add geolocate control to the map.
map.addControl(
  new mapboxgl.GeolocateControl({
    positionOptions: {
      enableHighAccuracy: true,
    },
    // When active the map will receive updates to the device's location as it changes.
    trackUserLocation: true,
    // Draw an arrow next to the location dot to indicate which direction the device is heading.
    showUserHeading: true,
  }),
);

// Add zoom and rotation controls to the map.
map.addControl(new mapboxgl.NavigationControl());

// disable map zoom when using scroll
map.scrollZoom.disable();

  const uberApiKey = 'dfH0ruu2OVrUwMqRFa4YecgIT6aGOvDh6T5YavaT';

  document.getElementById('uberForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const startLat = document.getElementById('startLat').value;
    const startLng = document.getElementById('startLng').value;
    const endLat = document.getElementById('endLat').value;
    const endLng = document.getElementById('endLng').value;

    const uberApiUrl = `https://api.uber.com/v1/guests/trips/estimates?start_latitude=${startLat}&start_longitude=${startLng}&end_latitude=${endLat}&end_longitude=${endLng}`;

    // Fetch data from Uber API for trip estimates
    fetch(uberApiUrl, {
      headers: {
        'Authorization': `Bearer ${uberApiKey}`,
        'Access-Control-Allow-Credentials' : true,
        'Content-Type': 'application/json',
      },
    })
    .then(response => response.json())
    .then(data => {
      // Process the Uber API response and display on the map
      console.log(data);

      // Add your logic to process the Uber API data and display on the map
      // For example, you can display the estimated prices or durations.

      // Clear existing markers
      map.removeLayer('markers');
      map.removeSource('markers');

      // Add a marker for the start location
      const startMarker = new mapboxgl.Marker()
        .setLngLat([parseFloat(startLng), parseFloat(startLat)])
        .addTo(map);

      // Add a marker for the end location
      const endMarker = new mapboxgl.Marker()
        .setLngLat([parseFloat(endLng), parseFloat(endLat)])
        .addTo(map);

      // Fit the map to the markers
      const bounds = new mapboxgl.LngLatBounds();
      bounds.extend(startMarker.getLngLat());
      bounds.extend(endMarker.getLngLat());
      map.fitBounds(bounds, { padding: 50 });
    })
    .catch(error => {
      console.error('Error fetching Uber data:', error);
    });
  });
</script>

</body>
</html>
